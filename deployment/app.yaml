# Databricks Apps Configuration
# This file configures how your application runs in Databricks Apps

# Command to start the application
command:
  - "uvicorn"
  - "app:app"
  - "--host"
  - "0.0.0.0"
  - "--port"
  - "8000"


# Environment variables
# Use Databricks secrets for sensitive values
env:
  # Databricks API configuration
  - name: DATABRICKS_TOKEN
    valueFrom: 'DATABRICKS_TOKEN'

  - name: DATABRICKS_MODEL
    value: 'ka-49410530-endpoint'

  - name: REPLICATE_API_TOKEN
    valueFrom: 'REPLICATE_API_TOKEN'

  - name: DEEPGRAM_API_TOKEN
    valueFrom: 'DEEPGRAM_API_TOKEN'

  # Database configuration
  - name: PGHOST
    value: 'ep-red-frost-d2yej5yx.database.us-east-1.cloud.databricks.com'

  - name: DATABRICKS_BASE_URL
    value: 'https://fevm-serverless-9cefok.cloud.databricks.com/serving-endpoints'

  - name: PGUSER
    value: 'service_brickchat'

  - name: PGDATABASE
    value: 'brickchat'

  - name: PG_PASS
    value: 'npg_wnEr0zdlb2SY'

  - name: DATABRICKS_LLM_MODEL
    value: 'databricks-gemma-3-12b'
  
  - name: DOCUMENTS_VOLUME_PATH
    value: "/Volumes/serverless_9cefok_catalog/sgfs/data/brickchat/"

# App resources - secrets the app's service principal can access
resources:
  - name: DATABRICKS_TOKEN
    secret:
      scope: sgscope
      key: DATABRICKS_TOKEN
      permission: READ
  - name: REPLICATE_API_TOKEN
    secret:
      scope: sgscope
      key: REPLICATE_API_TOKEN
      permission: READ
  - name: DEEPGRAM_API_TOKEN
    secret:
      scope: sgscope
      key: DEEPGRAM_API_TOKEN
      permission: READ

# Health check configuration (optional)
# healthcheck:
#   path: /health
#   interval: 30s
#   timeout: 5s